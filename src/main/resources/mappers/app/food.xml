<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="FoodDAO">
	<!-- 메뉴 리스트 -->
	<select id="getMenuList" parameterType="String" resultType="com.team.smart.app.vo.FoodMenuVO">
		SELECT * FROM food_menu_tbl
        <if test="value != null">
        	WHERE comp_seq = #{value}
        </if>
	</select>
	
	<!-- 스토어 리스트 -->
   <select id="getFoodStoreList" parameterType="java.util.Map" resultType="com.team.smart.app.vo.FoodStoreVO">
      SELECT uc.comp_org
            ,uc.comp_section
            ,uc.comp_hp
            ,uc.comp_branch
            ,c.f_seq
            ,c.comp_seq
            ,c.long_desc
            ,c.short_desc
            ,c.f_mainimg
            ,c.f_category
            ,cp.f_coupon_num
            ,cp.f_coupon_name
            ,cp.f_coupon_price
      FROM food_company_tbl c
      INNER JOIN user_company_tbl uc ON(uc.comp_seq = c.comp_seq)
      INNER JOIN (SELECT comp_seq, count(*) f_cnt FROM food_menu_tbl group by comp_seq) m
         ON(m.comp_seq = c.comp_seq)
        LEFT JOIN (SELECT comp_seq, f_coupon_num, f_coupon_name, f_coupon_price  FROM food_coupon_tbl where ROWNUM=1 ) cp ON (cp.comp_seq = c.comp_seq)
      <where>
          <if test="f_category != null">
            AND c.f_category = #{f_category}
          </if>
          <if test="comp_seq != null">
             and c.comp_seq = #{comp_seq}
          </if>
       </where>
   </select>
	
</mapper>